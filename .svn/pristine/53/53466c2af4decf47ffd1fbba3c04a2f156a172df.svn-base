# 配置一些sql的文件
# 差缺报表SQL,L1,L2,L3表示可能有全部的情况,默认先取部门一致的.到期日<0则视为0
sql.report.lack		= SELECT ID, NO, PRODUCT_NAME, NVL(LICENSE_NO, ENGINE_NO), DEPT_NAME, USER_NAME, BUSINESS_NO, APPLICANT, SALES_TIME, EFFECTIVE_TIME, LACKS, DAYS FROM ( SELECT T.*, (CASE WHEN XDAYS > 0 AND ((CTRL_TYPE \= '11') OR (FILE_STATUS \= '00' AND CTRL_TYPE \= '00')) THEN XDAYS ELSE 0 END) AS DAYS FROM ( SELECT T.*, P.NAME AS PRODUCT_NAME, (D.COMCNAME) AS DEPT_NAME, (U.USERNAME) AS USER_NAME, (CEIL(SYSDATE - T.SALES_TIME) - NVL(NVL(NVL(NVL(L.DAYS, L1.DAYS), L2.DAYS), L3.DAYS), ?)) AS XDAYS, NVL(NVL(NVL(NVL(L.CTRL_TYPE, L1.CTRL_TYPE), L2.CTRL_TYPE), L3.CTRL_TYPE), '11') AS CTRL_TYPE FROM T_F_DOCUMENT T LEFT JOIN PRPDCOMPANY D ON D.COMCODE \= T.BUSINESS_DEPT_ID LEFT JOIN PRPDUSER U ON U.USERCODE \= T.BUSINESS_USER_ID LEFT JOIN T_F_PRODUCT P ON P.ID \= T.PRODUCT_ID LEFT JOIN T_F_FILE_DEADLINE L ON L.STATUS \= '1' AND L.PRODUCT_ID \= T.PRODUCT_ID AND L.FILE_DEPT_ID \= T.BUSINESS_DEPT_ID LEFT JOIN T_F_FILE_DEADLINE L1 ON L1.STATUS \= '1' AND L1.PRODUCT_ID IS NULL AND L1.FILE_DEPT_ID \= T.BUSINESS_DEPT_ID LEFT JOIN T_F_FILE_DEADLINE L2 ON L2.STATUS \= '1' AND L2.PRODUCT_ID \= T.PRODUCT_ID AND L2.FILE_DEPT_ID IS NULL AND L2.COMPANY_ID \= T.BUSINESS_COMPANY_ID LEFT JOIN T_F_FILE_DEADLINE L3 ON L3.STATUS \= '1' AND L3.PRODUCT_ID IS NULL AND L3.FILE_DEPT_ID IS NULL AND L3.COMPANY_ID \= T.BUSINESS_COMPANY_ID WHERE T.FILE_STATUS IN (?, ?) AND T.STATUS \= ? ) T ) T

# 查询超期的SQL
sql.check.commit	= SELECT DISTINCT NO FROM ( SELECT T.ID, T.NO, T.FILE_STATUS, (CEIL(SYSDATE - T.SALES_TIME) - NVL(NVL(NVL(NVL(L.DAYS, L1.DAYS), L2.DAYS), L3.DAYS), ?)) AS DAYS, NVL(NVL(NVL(NVL(L.CTRL_TYPE, L1.CTRL_TYPE), L2.CTRL_TYPE), L3.CTRL_TYPE), ?) AS CTRL_TYPE FROM T_F_DOCUMENT T INNER JOIN T_F_DOCUMENT_FILE TT ON T.ID \= TT.DOCUMENT_ID INNER JOIN T_F_FILE_TYPE TF ON TT.FILE_TYPE_ID \= TF.ID LEFT JOIN T_F_FILE_DEADLINE L ON L.STATUS \= '1' AND L.PRODUCT_ID \= T.PRODUCT_ID AND L.FILE_DEPT_ID \= T.BUSINESS_DEPT_ID LEFT JOIN T_F_FILE_DEADLINE L1 ON L1.STATUS \= '1' AND L1.PRODUCT_ID IS NULL AND L1.FILE_DEPT_ID \= T.BUSINESS_DEPT_ID LEFT JOIN T_F_FILE_DEADLINE L2 ON L2.STATUS \= '1' AND L2.PRODUCT_ID \= T.PRODUCT_ID AND L2.FILE_DEPT_ID IS NULL AND L2.COMPANY_ID \= T.BUSINESS_COMPANY_ID LEFT JOIN T_F_FILE_DEADLINE L3 ON L3.STATUS \= '1' AND L3.PRODUCT_ID IS NULL AND L3.FILE_DEPT_ID IS NULL AND L3.COMPANY_ID \= T.BUSINESS_COMPANY_ID WHERE T.FILE_STATUS IN (?, ?) AND T.STATUS \= ? AND TF.SIGNED <> ? AND T.BUSINESS_NO \= ?) A WHERE DAYS > 0 AND ((CTRL_TYPE \= ?) OR (FILE_STATUS \= ? AND CTRL_TYPE \= ?))

#档案借阅的查询SQL
sql.fileLending.query	= SELECT T.ID, T.NO, T.TYPE, FD.BORROWER_NAME, FD.INSERT_TIME, FD.EXPECTED_RETURN_DATE, T.FILE_STATUS, TRUNC(SYSDATE - FD.EXPECTED_RETURN_DATE) AS RETURN_DATE1, TRUNC(SYSDATE - FD.EXPECTED_RETURN_DATE) AS RETURN_DATE2, U.USERNAME, T.LENT, FD.ID AS LENDING_ID FROM T_F_DOCUMENT T LEFT JOIN ( SELECT DISTINCT F.DOCUMENT_ID, L.* FROM T_F_FILE_LENDING L INNER JOIN T_F_FILE_LENDING_DETAIL D ON D.LENDING_ID \= L.ID INNER JOIN T_F_DOCUMENT_FILE F ON F.FILE_ID \= D.FILE_ID WHERE L.STATUS IN ('1', '2') ) FD ON FD.DOCUMENT_ID \= T.ID LEFT JOIN PRPDUSER U ON U.USERCODE \= FD.USER_ID
# ORDER BY T.CREATE_TIME DESC, T.PROPOSAL_NO, T.NO, T.ENDOR_NO, T.ID

# 查询投保单的客户信息
sql.queryClient.proposal	= SELECT T.INSUREDTYPE, T.INSUREDCODE, T.IDENTIFYTYPE, T.IDENTIFYNUMBER, T.INSUREDFLAG, NVL(C.IDINVALIDDATE, U.ORGINVALIDDATE) FROM PRPTINSURED T LEFT JOIN PRPDCUSTOMERIDV C ON C.CUSTOMERCODE \= T.INSUREDCODE AND T.INSUREDTYPE \= '1' LEFT JOIN PRPDCUSTOMERUNIT U ON U.CUSTOMERCODE \= T.INSUREDCODE AND T.INSUREDTYPE \= '2' WHERE T.PROPOSALNO \= ? AND T.INSUREDFLAG \= ?
	
# 查询保单的客户信息
sql.queryClient.policy	= SELECT T.INSUREDTYPE, T.INSUREDCODE, T.IDENTIFYTYPE, T.IDENTIFYNUMBER, T.INSUREDFLAG, NVL(C.IDINVALIDDATE, U.ORGINVALIDDATE) FROM PRPCINSURED T LEFT JOIN PRPDCUSTOMERIDV C ON C.CUSTOMERCODE \= T.INSUREDCODE AND T.INSUREDTYPE \= '1' LEFT JOIN PRPDCUSTOMERUNIT U ON U.CUSTOMERCODE \= T.INSUREDCODE AND T.INSUREDTYPE \= '2' WHERE T.POLICYNO \= ? AND T.INSUREDFLAG \= ?

# 查询批单的客户信息
sql.queryClient.endor		= SELECT T.INSUREDTYPE, T.INSUREDCODE, T.IDENTIFYTYPE, T.IDENTIFYNUMBER, T.INSUREDFLAG, NVL(C.IDINVALIDDATE, U.ORGINVALIDDATE) FROM PRPCPINSURED T LEFT JOIN PRPDCUSTOMERIDV C ON C.CUSTOMERCODE \= T.INSUREDCODE AND T.INSUREDTYPE \= '1' LEFT JOIN PRPDCUSTOMERUNIT U ON U.CUSTOMERCODE \= T.INSUREDCODE AND T.INSUREDTYPE \= '2' WHERE T.POLICYNO \= ? AND T.INSUREDFLAG \= ?
	
	
# 查询投保单的车主信息.PRPTCAROWNER表中CARINSUREDRELATION=1表示单位，与投保人/被保人表相反
sql.queryCarOwner.proposal	= SELECT DECODE(C.CARINSUREDRELATION, '3', '1', '2') AS INSUREDTYPE, NULL AS CAROWNERCODE, T.IDENTIFYTYPE, T.CERTIFICATENO, '3' AS CAROWNERFLAG, NULL AS INVALIDDATE FROM PRPTCAROWNER T INNER JOIN PRPTITEMCAR C ON C.PROPOSALNO \= T.PROPOSALNO WHERE T.PROPOSALNO \= ?
	
# 查询保单的车主信息
sql.queryCarOwner.policy	= SELECT DECODE(C.CARINSUREDRELATION, '3', '1', '2') AS INSUREDTYPE, NULL AS CAROWNERCODE, T.IDENTIFYTYPE, T.CERTIFICATENO, '3' AS CAROWNERFLAG, NULL AS INVALIDDATE FROM PRPCCAROWNER T INNER JOIN PRPCITEMCAR C ON C.POLICYNO \= T.POLICYNO WHERE T.POLICYNO \= ?

# 查询批单的车主信息
sql.queryCarOwner.endor		= SELECT DECODE(C.CARINSUREDRELATION, '3', '1', '2') AS INSUREDTYPE, NULL AS CAROWNERCODE, T.IDENTIFYTYPE, T.CERTIFICATENO, '3' AS CAROWNERFLAG, NULL AS INVALIDDATE FROM PRPCPCAROWNER T INNER JOIN PRPCPITEMCAR C ON C.POLICYNO \= T.POLICYNO WHERE T.POLICYNO \= ?
	
# 查询大保单的客户信息
sql.queryClient.proposal.coverNote	= SELECT T.INSUREDTYPE, T.INSUREDCODE, T.IDENTIFYTYPE, T.IDENTIFYNUMBER, T.INSUREDFLAG, NVL(C.IDINVALIDDATE, U.ORGINVALIDDATE) FROM PRPCCUSTOMER T LEFT JOIN PRPDCUSTOMERIDV C ON C.CUSTOMERCODE \= T.INSUREDCODE AND T.INSUREDTYPE \= '1' LEFT JOIN PRPDCUSTOMERUNIT U ON U.CUSTOMERCODE \= T.INSUREDCODE AND T.INSUREDTYPE \= '2' WHERE T.POLICYNO \= ? AND T.INSUREDFLAG \= ?

# 查询大保单批单的客户信息
sql.queryClient.endor.coverNote		= SELECT T.INSUREDTYPE, T.INSUREDCODE, T.IDENTIFYTYPE, T.IDENTIFYNUMBER, T.INSUREDFLAG, NVL(C.IDINVALIDDATE, U.ORGINVALIDDATE) FROM PRPCPCUSTOMER T LEFT JOIN PRPDCUSTOMERIDV C ON C.CUSTOMERCODE \= T.INSUREDCODE AND T.INSUREDTYPE \= '1' LEFT JOIN PRPDCUSTOMERUNIT U ON U.CUSTOMERCODE \= T.INSUREDCODE AND T.INSUREDTYPE \= '2' WHERE T.POLICYNO \= ? AND T.INSUREDFLAG \= ?
	
	
# 查询投保单的车辆信息
sql.queryVehicle.proposal	= SELECT T.USENATURECODE, C.VEHICLECATEGORYCODE, T.ENROLLDATE, T.VINNO, T.ENGINENO FROM PRPTITEMCAR T LEFT JOIN PRPTITEMCAREXT C ON C.PROPOSALNO \= T.PROPOSALNO AND C.ITEMNO \= T.ITEMNO WHERE T.PROPOSALNO \= ?
	
# 查询保单的车辆信息
sql.queryVehicle.policy		= SELECT T.USENATURECODE, C.VEHICLECATEGORYCODE, T.ENROLLDATE, T.VINNO, T.ENGINENO FROM PRPCITEMCAR T LEFT JOIN PRPCITEMCAREXT C ON C.POLICYNO \= T.POLICYNO AND C.ITEMNO \= T.ITEMNO WHERE T.POLICYNO \= ?

# 查询批单的车辆信息
sql.queryVehicle.endor		= SELECT T.USENATURECODE, C.VEHICLECATEGORYCODE, T.ENROLLDATE, T.VINNO, T.ENGINENO FROM PRPCPITEMCAR T LEFT JOIN PRPPITEMCAREXT C ON C.ENDORSENO \= T.ENDORSENO AND C.ITEMNO \= T.ITEMNO WHERE T.POLICYNO \= ?
	
	
#上传资料审核查询有未审核的的上传承保资料的Document
sql.file.core.audit	   = SELECT T.ID , T.NO , T.FILE_APPROVE_STATUS, T.APPLICANT  AS APPLICANT,   PU3.USERNAME AS SALESNAME,   PC.COMCNAME  AS COMCNAME,    T.AGENT_NAME AS AGENT_NAME,  PU1.USERNAME AS BUSINESSNAME,PU2.USERNAME AS USERNAME, (SELECT COUNT(*) FROM T_F_DOCUMENT_FILE TF\tINNER JOIN T_F_FILE F ON TF.FILE_ID \= F.ID    WHERE T.ID \= TF.DOCUMENT_ID\tAND F.FILE_APPROVE_STATUS IS NOT NULL AND (TF.STATUS \= ? AND F.FILE_APPROVE_STATUS \= ?)) AS UNAUDITED_COUNT FROM T_F_DOCUMENT T  LEFT JOIN PRPDCOMPANY PC ON T.BUSINESS_DEPT_ID \= PC.COMCODE  LEFT JOIN PRPDUSER PU1 ON T.BUSINESS_USER_ID \= PU1.USERCODE  LEFT JOIN PRPDUSER PU2 ON T.USER_ID \= PU2.USERCODE           LEFT JOIN PRPDUSER PU3 ON T.SALES_ID \= PU3.USERCODE\t\t\tWHERE EXISTS (\t\t\t\t\t\t\t\t\t\tSELECT 1 FROM T_F_DOCUMENT_FILE TF\t\t\t\t\t\t\tINNER JOIN T_F_FILE TT ON TF.FILE_ID \= TT.ID    WHERE T.ID \= TF.DOCUMENT_ID\tAND TT.FILE_APPROVE_STATUS IS NOT NULL AND ((TF.STATUS \= ? AND TT.FILE_APPROVE_STATUS \= ?) OR TT.FILE_APPROVE_STATUS IN (?, ?)) )
#纸质档案归档查询
sql.query.paperFile	= SELECT ID,NO,VISASERIALNO,LACKS,FILE_STATUS,APPLICANT,SALESNAME,COMCNAME,AGENT_NAME,BUSINESSNAME,VISASTATUS,VISACODE,VISANAME,BUSINESS_COMPANY_ID,PROPOSAL_NO,POLICY_NO,ENDOR_NO,COMCODE,BUSINESS_NO,PRODUCT_ID,TYPE,VISATYPE,SALES_TIME FROM (SELECT T.ID || ',' || V.VISASERIALNO ID,DECODE(V.VISASTATUS,'06','\u4F5C\u5E9F\u5355\u8BC1','05','\u9057\u5931\u5355\u8BC1', T.NO) NO,V.VISASERIALNO,T.LACKS,CASE WHEN T.FILE_STATUS \= '11' AND V.DUSTYFLAG IS NOT NULL THEN '01' WHEN T.FILE_STATUS \= '00' AND V.DUSTYFLAG IS NOT NULL THEN '01' WHEN T.FILE_STATUS \= '10' AND V.DUSTYFLAG IS NOT NULL THEN '01' ELSE T.FILE_STATUS END AS FILE_STATUS,T.APPLICANT AS APPLICANT,PU3.USERNAME AS SALESNAME,PC.COMCNAME AS COMCNAME,T.AGENT_NAME AS AGENT_NAME,PU1.USERNAME AS BUSINESSNAME,V.VISASTATUS AS VISASTATUS,V.VISACODE AS VISACODE,V.VISANAME AS VISANAME, T.BUSINESS_COMPANY_ID AS BUSINESS_COMPANY_ID,T.PROPOSAL_NO AS PROPOSAL_NO,T.POLICY_NO AS POLICY_NO,T.ENDOR_NO AS ENDOR_NO,PC.COMCODE AS COMCODE,T.BUSINESS_NO AS BUSINESS_NO,T.PRODUCT_ID AS PRODUCT_ID,T.TYPE AS TYPE,'V' AS VISATYPE,T.SALES_TIME AS SALES_TIME FROM T_F_DOCUMENT T INNER JOIN VSMARK V ON T.NO \= V.BUSINESSNO LEFT JOIN PRPDCOMPANY PC ON T.BUSINESS_DEPT_ID \= PC.COMCODE LEFT JOIN PRPDUSER PU1 ON T.BUSINESS_USER_ID \= PU1.USERCODE LEFT JOIN PRPDUSER PU3 ON T.SALES_ID \= PU3.USERCODE WHERE V.VISASTATUS IN('04','05','06') AND TYPE <> 'V' UNION SELECT V.VISASERIALNO ID,V.VISASTATUS AS NO,V.VISASERIALNO,CASE WHEN V.VISASTATUS \= '05' AND V.DUSTYFLAG IS NULL THEN '\u9057\u5931\u8BF4\u660E' WHEN V.VISASTATUS \= '06' AND V.DUSTYFLAG IS NULL THEN '\u4F5C\u5E9F\u5355\u8BC1' WHEN V.VISASTATUS \= '04' AND V.DUSTYFLAG IS NULL THEN '\u7559\u5B58\u8054' ELSE '' END AS LACKS, DECODE(V.DUSTYFLAG,'04','11','00') AS FILE_STATUS,'' AS APPLICANT,'' AS SALESNAME,'' AS COMCNAME,'' AS AGENT_NAME,'' AS BUSINESSNAME,V.VISASTATUS AS VISASTATUS,V.VISACODE AS VISACODE, V.VISANAME AS VISANAME, V.COMCODE AS BUSINESS_COMPANY_ID,'' AS PROPOSAL_NO,'' AS POLICY_NO,'' AS ENDOR_NO,V.COMCODE AS COMCODE,'' AS BUSINESS_NO,'' AS PRODUCT_ID,'V' AS TYPE,'V' AS VISATYPE,V.USEDATE AS SALES_TIME FROM VSMARK V WHERE V.VISASTATUS IN('04','05','06') AND V.BUSINESSNO IS NULL UNION SELECT T.ID,T.NO,'' AS VISASERIALNO,T.LACKS,T.FILE_STATUS AS FILE_STATUS,T.APPLICANT AS APPLICANT,PU3.USERNAME AS SALESNAME,PC.COMCNAME AS COMCNAME,T.AGENT_NAME AS AGENT_NAME,PU1.USERNAME AS BUSINESSNAME,'' AS VISASTATUS,'' AS VISACODE,'' AS VISANAME,T.BUSINESS_COMPANY_ID AS BUSINESS_COMPANY_ID,T.PROPOSAL_NO AS PROPOSAL_NO,T.POLICY_NO AS POLICY_NO,T.ENDOR_NO AS ENDOR_NO,PC.COMCODE AS COMCODE,T.BUSINESS_NO AS BUSINESS_NO,T.PRODUCT_ID AS PRODUCT_ID,T.TYPE AS TYPE,'V' AS VISATYPE,T.SALES_TIME AS SALES_TIME FROM T_F_DOCUMENT T LEFT JOIN PRPDCOMPANY PC ON T.BUSINESS_DEPT_ID \= PC.COMCODE LEFT JOIN PRPDUSER PU1 ON T.BUSINESS_USER_ID \= PU1.USERCODE LEFT JOIN PRPDUSER PU3 ON T.SALES_ID \= PU3.USERCODE WHERE TYPE <> 'V' AND NOT EXISTS(SELECT * FROM VSMARK V WHERE T.NO \= V.BUSINESSNO))