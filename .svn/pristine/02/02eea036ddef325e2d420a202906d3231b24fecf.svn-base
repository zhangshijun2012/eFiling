package com.sinosoft.efiling.struts2.action;

import com.sinosoft.efiling.hibernate.dao.DocumentDao;
import com.sinosoft.efiling.hibernate.entity.Document;
import com.sinosoft.efiling.service.DocumentAuditService;
import com.sinosoft.efiling.service.DocumentService;
import com.sinosoft.util.Helper;
import com.sinosoft.util.StringHelper;
import com.sinosoft.util.struts2.action.EntityActionSupport;

public class DataImigrationAction extends EntityActionSupport<Document, DocumentDao, DocumentService, String> {
	private static final long serialVersionUID = 3373369754177726170L;
	protected DocumentAuditService documentAuditService;

	public DocumentAuditService getDocumentAuditService() {
		return documentAuditService;
	}

	public void setDocumentAuditService(DocumentAuditService documentAuditService) {
		this.documentAuditService = documentAuditService;
	}

	// 重分
	// String[] bussNosCQ = { "8105015006140000006000", "8105015006140000004000", "8105015006140000005000",
	// "8105015006140000001000", "8105015006140000003000", "8105015007140000012000", "8105015007140000013000",
	// "8105015007140000010000", "8105015007140000009000", "8105015007140000008000", "8105015007140000007000",
	// "8105015007140000006000", "8105015007140000003000", "8105015007140000004000", "8105015007140000001000",
	// "8105015007140000033000", "8105015007140000032000", "8105015007140000031000", "8105015007140000030000",
	// "8105015007140000034000", "8105015007140000029000", "8105015007140000024000", "8105015007140000027000",
	// "8105015007140000025000", "8105015007140000022000", "8105015007140000019000", "8105015007140000020000",
	// "8105015007140000015000", "8105015007140000016000", "8105015007140000103000" };
	//
	// String[] bussNos = {
	// // 重分
	// "8105015006140000006000",
	// "8105015006140000004000",
	// "8105015006140000005000",
	// "8105015006140000001000",
	// "8105015006140000003000",
	// "8105015007140000012000",
	// "8105015007140000013000",
	// "8105015007140000010000",
	// "8105015007140000009000",
	// "8105015007140000008000",
	// "8105015007140000007000",
	// "8105015007140000006000",
	// "8105015007140000003000",
	// "8105015007140000004000",
	// "8105015007140000001000",
	// "8105015007140000033000",
	// "8105015007140000032000",
	// "8105015007140000031000",
	// "8105015007140000030000",
	// "8105015007140000034000",
	// "8105015007140000029000",
	// "8105015007140000024000",
	// "8105015007140000027000",
	// "8105015007140000025000",
	// "8105015007140000022000",
	// "8105015007140000019000",
	// "8105015007140000020000",
	// "8105015007140000015000",
	// "8105015007140000016000",
	// "8105015007140000103000",
	// // 浙分
	// "8105013301130000033000",
	// "8105013301130000032000",
	// "8105013301130000030000",
	// "8105013301130000028000",
	// "8105013301130017888000",
	// "8105013301130000027000",
	// "8105013301130017762000",
	// "8105013301130000025000",
	// "8105013301130000022000",
	// "8105013301130000021000",
	// "8105013301140000081000",
	// "8105013301140000080000",
	// "8105013301140000079000",
	// "8105013301140000078000",
	// "8105013301140000076000",
	// "8105013301140000077000",
	// "8105013301140000075000",
	// "8105013301140000072000",
	// "8105013301140000074000",
	// "8105013301140000073000",
	// "8105013301140000071000",
	// "8105013301140000069000",
	// "8105013301140000070000",
	// "8105013301140000066000",
	// "8105013301140000067000",
	// "8105013301140000068000",
	// "8105013301140000065000",
	// "8105013301140000064000",
	// "8105013301140000063000",
	// "8105013301140000083000",
	//
	// // 广分
	// "8105014400140000023000", "8105014400140000024000", "8105014400140000019000",
	// "8105014400140000021000",
	// "8105014400140000020000",
	// "8105014400140000017000",
	// "8105014400140000018000",
	// "8105014400140000016000",
	// "8105014400140000015000",
	// "8105014400140000014000",
	// "8105014400140000013000",
	// "8105014400140000012000",
	// "8105014400140000007000",
	// "8105014400140000008000",
	// "8105014400140000006000",
	// "8105014400140000005000",
	// "8105014400140000004000",
	// "8105014400140000003000",
	// "8105014400140000001000",
	// "8105014400140000002000",
	// "8105014400140000048000",
	// "8105014400140000047000",
	// "8105014400140000046000",
	// "8105014400140000045000",
	// "8105014400140000042000",
	// "8105014400140000044000",
	// "8105014400140000043000",
	// "8105014400140000041000",
	// "8105014400140000039000",
	// "8105014400140000040000",
	//
	// // 山东
	// "8105013701140000021000", "8105013701140000019000", "8105013701140000022000", "8105013701140000016000",
	// "8105013701140000015000", "8105013701140000013000", "8105013701140000014000", "8105013701140000012000",
	// "8105013701140000011000", "8105013701140000009000", "8105013701140000010000", "8105013701140000006000",
	// "8105013701140000008000",
	// "8105013701140000005000",
	// "8105013701140000007000",
	// "8105013701140000002000",
	// "8105013701140000003000",
	// "8105013701140000001000",
	// "8105013701140000042000",
	// "8105013701140000040000",
	// "8105013701140000035000",
	// "8105013701140000036000",
	// "8105013701140000034000",
	// "8105013701140000039000",
	// "8105013701140000033000",
	// "8105013701140000031000",
	// "8105013701140000032000",
	// "8105013701140000027000",
	// "8105013701140000030000",
	// "8105013701140000029000",
	//
	// // 北京
	// "8105011100140000040000", "8105011100140000041000", "8105011100140000038000", "8105011100140000039000",
	// "8105011100140000032000", "8105011100140000037000", "8105011100140000033000", "8105011100140000034000",
	// "8105011100140000035000", "8105011100140000030000", "8105011100140000029000", "8105011100140000031000",
	// "8105011100140000027000",
	// "8105011100140000026000",
	// "8105011100140000025000",
	// "8105011100140000028000",
	// "8105011100140000023000",
	// "8105011100140000022000",
	// "8105011100140000024000",
	// "8105011100140000145000",
	// "8105011100140000147000",
	// "8105011100140000144000",
	// "8105011100140000143000",
	// "8105011100140000142000",
	// "8105011100140000141000",
	// "8105011100140000139000",
	// "8105011100140000140000",
	// "8105011100140000136000",
	// "8105011100140000137000",
	// "8105011100140000161000",
	// // "
	// // "宁波
	// "8105013399140000020000", "8105013399140000019000", "8105013399140000017000", "8105013399140000018000",
	// "8105013399140000016000", "8105013399140000015000", "8105013399140000014000", "8105013399140000011000",
	// "8105013399140000008000", "8105013399140000010000", "8105013399140000009000", "8105013399140000004000",
	// "8105013399140000006000", "8105013399140000003000", "8105013399140000002000", "8105013399140000041000",
	// "8105013399140000039000", "8105013399140000037000", "8105013399140000038000", "8105013399140000034000",
	// "8105013399140000035000", "8105013399140000036000", "8105013399140000032000", "8105013399140000033000",
	// "8105013399140000031000", "8105013399140000030000", "8105013399140000028000", "8105013399140000029000",
	// "8105013399140000026000", "8105013399140000025000" };

	public void validateSave() {
		if (Helper.isEmpty(no)) {
			addFieldError("no", "请指定要补录的数据!");
		}
	}

	/**
	 * 保存业务数据
	 */
	public String save() {
		int count = 0;
		StringBuilder message = new StringBuilder();
		Document document;
		logger.debug("DocumentAuditServiceAction.save(),生成保单数据接口调用:" + StringHelper.join(no));
		int index = 1;
		for (String bussNo : no) {
			logger.debug("DocumentAuditServiceAction.save(),生成保单数据接口调用:" + bussNo);
			message.append(index++).append(".\t");
			try {
				document = documentAuditService.save(bussNo);
				// documentAuditService.share(bussNo);
				message.append(bussNo).append("保存成功,");
				message.append("投保单号:").append(document.getProposalNo());
				message.append(",保单号:").append(document.getPolicyNo());
				message.append(",批单号:").append(document.getEndorNo()).append("\n");
				count++;
				logger.debug("DocumentAuditServiceAction.save(),生成保单数据接口调用:" + bussNo + "成功!");
			} catch (Exception e) {
				message.append(bussNo).append("保存失败:" + e);
				logger.error("DocumentAuditServiceAction.save(),生成保单数据接口调用:" + bussNo + "异常!", e);
			}
		}

		message.insert(0, "成功保存" + count + "条数据!\n");
		write(message.toString());
		return null;
	}

	private String[] no;

	public String[] getNo() {
		return no;
	}

	public void setNo(String[] no) {
		this.no = no;
	}
}